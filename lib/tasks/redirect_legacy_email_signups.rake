desc "Redirect legacy email signup pages to parent page"
task redirect_legacy_email_signups: :environment do
  redirects = specialist_sector_slugs.map do |slug|
    {
      incoming_path: "/topic/#{slug}/email-signup",
      destination: "/topic/#{slug}",
    }
  end

  redirects.each do |redirect|
    begin
      route = Route.find_by(incoming_path: redirect[:incoming_path])
    rescue Mongoid::Errors::DocumentNotFound
      # We expect some routes to be blank, e.g where a specialist sector is only in draft
      next puts "No route found for: #{redirect[:incoming_path]}" if route.blank?
    end

    redirect_details = {
      route_type: "exact",
      handler: "redirect",
      redirect_to: redirect[:destination],
      redirect_type: "permanent",
    }

    route.update(redirect_details)

    puts "Redirected #{redirect[:incoming_path]} to #{redirect[:destination]}"
  end

  RouterReloader.reload
end

def specialist_sector_slugs
  # Query in collections-publisher -> Topic.where(state: ["draft", "published"]).where.not(parent_id: nil).map(&:full_slug)

  [
    "immigration-operational-guidance/non-compliance-biometric-registration",
    "oil-and-gas/carbon-capture-and-storage",
    "oil-and-gas/environment-reporting-and-regulation",
    "oil-and-gas/exploration-and-production",
    "oil-and-gas/fields-and-wells",
    "oil-and-gas/infrastructure-and-decommissioning",
    "oil-and-gas/licensing",
    "oil-and-gas/onshore-oil-and-gas",
    "immigration-operational-guidance/asylum-policy",
    "immigration-operational-guidance/enforcement",
    "local-government/business-rates",
    "commercial-fishing-fisheries/vessel-crew-safety-certification",
    "producing-distributing-food/egg-production-marketing",
    "commercial-fishing-fisheries/regulations-monitoring-enforcement",
    "housing/land-development-opportunities",
    "housing/procurement-panels",
    "housing/design-and-sustainability",
    "benefits-credits/tax-credits",
    "benefits-credits/child-benefit",
    "immigration-operational-guidance/commerical-casework-guidance",
    "immigration-operational-guidance/entry-clearance-guidance",
    "immigration-operational-guidance/modernised-guidance",
    "immigration-operational-guidance/stateless-guidance",
    "housing/social-housing-regulation-england",
    "environmental-management/boating",
    "environmental-management/chemicals",
    "environmental-management/environmental-permits",
    "environmental-management/environmental-risk-management",
    "environmental-management/fisheries-rod-licensing",
    "environmental-management/flooding-coastal-change",
    "environmental-management/land-management",
    "environmental-management/marine",
    "environmental-management/oil-storage",
    "environmental-management/waste",
    "environmental-management/water",
    "environmental-management/wildlife-habitat-conservation",
    "competition/mergers",
    "competition/markets",
    "competition/regulatory-appeals-references",
    "running-charity/fundraising",
    "running-charity/managing-charity",
    "running-charity/trustee-role-board",
    "running-charity/staff-volunteers",
    "running-charity/charitys-work",
    "prisons-probation/healthcare",
    "prisons-probation/information-suppliers",
    "prisons-probation/mappa",
    "prisons-probation/operational-guidance",
    "working-sea/health-safety",
    "working-sea/medical-certification",
    "working-sea/training-certification",
    "ships-cargoes/cargo-safety",
    "ships-cargoes/construction-maintenance-operation",
    "ships-cargoes/hydrography",
    "ships-cargoes/inland-waterways",
    "ships-cargoes/large-yachts",
    "ships-cargoes/m-notices",
    "ships-cargoes/pollution-prevention",
    "ships-cargoes/surveys-inspections",
    "ships-cargoes/ship-registration",
    "keeping-farmed-animals/cattle-deaths",
    "keeping-farmed-animals/cattle-identity-registration",
    "keeping-farmed-animals/cattle-movement",
    "producing-distributing-food/crops-horticulture",
    "producing-distributing-food/dairy-milk-production",
    "producing-distributing-food/food-labelling",
    "producing-distributing-food/import-export",
    "producing-distributing-food/meat-production",
    "producing-distributing-food/sugar",
    "farming-food-grants-payments/private-storage-aid",
    "farming-food-grants-payments/school-milk-scheme",
    "farming-food-grants-payments/intervention-schemes",
    "immigration-operational-guidance/fees-forms",
    "immigration-operational-guidance/rights-responsibilities",
    "immigration-operational-guidance/immigration-rules",
    "commercial-fishing-fisheries/funding",
    "commercial-fishing-fisheries/vessel-licensing",
    "commercial-fishing-fisheries/vessel-surveys-inspections",
    "planning-development/harbour-orders",
    "planning-development/marine-licences",
    "planning-development/marine-planning",
    "planning-development/protected-sites-species",
    "environmental-management/oil-spills",
    "keeping-farmed-animals/sheep-identity-registration",
    "running-charity/setting-up",
    "working-sea/maritime-safety",
    "ships-cargoes/emergency-life-saving-equipment",
    "ships-cargoes/high-speed-craft",
    "ships-cargoes/shipping-dangerous-goods",
    "local-government/council-tax",
    "local-government/councils-elections",
    "local-government/data-collection-reporting",
    "local-government/finance-capital-assets",
    "local-government/services",
    "local-government/transparency",
    "legal-aid-for-providers/change",
    "legal-aid-for-providers/civil",
    "legal-aid-for-providers/contracts",
    "legal-aid-for-providers/crime",
    "legal-aid-for-providers/electronic-working",
    "legal-aid-for-providers/forms",
    "legal-aid-for-providers/high-cost-complex-cases",
    "legal-aid-for-providers/make-application",
    "legal-aid-for-providers/payments-processing",
    "legal-aid-for-providers/submit-claim",
    "legal-aid-for-providers/tenders",
    "health-protection/chemical-hazards",
    "health-protection/emergency-response",
    "health-protection/infectious-diseases",
    "health-protection/radiation",
    "health-protection/services",
    "land-registration/business-mortgage-services",
    "land-registration/data",
    "land-registration/practice-guides",
    "land-registration/searches-fees-forms",
    "intellectual-property/copyright",
    "intellectual-property/designs",
    "intellectual-property/law-practice",
    "intellectual-property/patents",
    "intellectual-property/trade-marks",
    "personal-tax/income-tax",
    "personal-tax/national-insurance",
    "personal-tax/self-assessment",
    "business-tax/paye",
    "business-tax/vat",
    "outdoor-access-recreation/parks-trails-nature-reserves",
    "outdoor-access-recreation/recreation",
    "outdoor-access-recreation/rights-of-way-open-access",
    "planning-development/landscape",
    "keeping-farmed-animals/bovine-tb",
    "keeping-farmed-animals/poultry-registration",
    "keeping-farmed-animals/preventing-disease",
    "keeping-farmed-animals/reporting-disease",
    "keeping-farmed-animals/shows-fairs-markets",
    "business-tax/corporation-tax",
    "personal-tax/capital-gains-tax",
    "business-tax/insurance-premium-tax",
    "business-tax/self-employed",
    "business-tax/pension-scheme-administration",
    "transport/planning-infrastructure",
    "transport/regulations-safety-security",
    "transport/traffic-road-management",
    "transport/environment",
    "transport/transporting-goods",
    "competition/competition-act-cartels",
    "competition/consumer-protection",
    "coal/property-development",
    "coal/reports-data",
    "coal/permits-licences",
    "coal/environment",
    "business-tax/gambling-duties",
    "business-tax/international-tax",
    "government-digital-guidance/content-publishing",
    "dealing-with-hmrc/paying-hmrc",
    "transport/motorways-major-roads",
    "environmental-management/nuclear-regulation",
    "housing/funding-programmes",
    "business-tax/employment-related-securities",
    "business-tax/construction-industry-scheme",
    "dealing-with-hmrc/phishing-scams",
    "business-tax/capital-allowances",
    "ships-cargoes/maritime-passenger-rights",
    "business-tax/ir35",
    "high-speed-2/business",
    "high-speed-2/design-development",
    "high-speed-2/environment",
    "high-speed-2/maps-plans",
    "high-speed-2/property",
    "running-charity/money-accounts",
    "driving-motorcyle-instructors/approved-driving-instructors",
    "driving-motorcyle-instructors/booking-tests",
    "driving-motorcyle-instructors/driving-test-policies-rules",
    "driving-motorcyle-instructors/improving-training-skills",
    "driving-motorcyle-instructors/large-goods-vehicle-instructors",
    "driving-motorcyle-instructors/motorycle-instructors",
    "schools-colleges-childrens-services/inspections",
    "personal-tax/savings-investment-tax",
    "dealing-with-hmrc/tax-avoidance",
    "schools-colleges-childrens-services/curriculum-qualifications",
    "schools-colleges-childrens-services/exams-testing-assessment",
    "further-education-skills/apprenticeships",
    "further-education-skills/vocational-qualifications",
    "business-tax/alcohol-duties",
    "driving-motorcyle-instructors/reusing-dvsa-logos-information",
    "business-tax/fuel-duty",
    "business-tax/tobacco-products-duty",
    "dealing-with-hmrc/software-development",
    "community-organisations/community-amateur-sports-clubs",
    "business-tax/climate-change-levy",
    "business-tax/landfill-tax",
    "business-tax/aggregates-levy",
    "business-tax/air-passenger-duty",
    "dealing-with-hmrc/shared-workspace",
    "defence-armed-forces/support-services-veterans-families",
    "business-tax/money-laundering-regulations",
    "schools-colleges-childrens-services/adoption-fostering",
    "schools-colleges-childrens-services/data-collection-statistical-returns",
    "schools-colleges-childrens-services/early-years",
    "schools-colleges-childrens-services/looked-after-children",
    "schools-colleges-childrens-services/opening-academy-free-school",
    "schools-colleges-childrens-services/safeguarding-children",
    "schools-colleges-childrens-services/school-college-funding-finance",
    "schools-colleges-childrens-services/running-school-college",
    "schools-colleges-childrens-services/school-behaviour-attendance",
    "schools-colleges-childrens-services/school-careers-employment",
    "schools-colleges-childrens-services/special-educational-needs-disabilities",
    "schools-colleges-childrens-services/support-for-children-young-people",
    "personal-tax/inheritance-tax",
    "company-registration-filing/starting-company",
    "company-registration-filing/running-company",
    "company-registration-filing/closing-company",
    "personal-tax/trusts",
    "defence-armed-forces/military-awards-commemorations",
    "defence-armed-forces/military-equipment-logistics-technology",
    "defence-armed-forces/military-recruitment-training-operations",
    "defence-armed-forces/ministry-of-defence-estate",
    "defence-armed-forces/support-services-military-defence-personnel-families",
    "business-enterprise/manufacturing",
    "personal-tax/living-working-abroad-offshore",
    "personal-tax/leaving-uk",
    "personal-tax/coming-to-uk",
    "personal-tax/non-resident-landlord-scheme",
    "personal-tax/foreign-entertainer-rules",
    "business-tax/import-export",
    "business-tax/stamp-taxes",
    "further-education-skills/administration",
    "keeping-farmed-animals/animal-welfare",
    "mot/being-mot-tester",
    "mot/get-check-mot",
    "mot/forms",
    "mot/manuals",
    "mot/run-mot-test-station",
    "dealing-with-hmrc/complaints-appeals",
    "dealing-with-hmrc/tax-compliance",
    "dealing-with-hmrc/tax-agent-guidance",
    "medicines-medical-devices-blood/blood-regulation-safety",
    "medicines-medical-devices-blood/clinical-trials-investigations",
    "medicines-medical-devices-blood/good-practice",
    "medicines-medical-devices-blood/herbal-homeopathic-medicines",
    "medicines-medical-devices-blood/manufacturing-wholesaling-importing-exporting-medicines",
    "medicines-medical-devices-blood/marketing-authorisations-variations-licensing",
    "medicines-medical-devices-blood/medical-devices-regulation-safety",
    "business-tax/investment-schemes",
    "medicines-medical-devices-blood/vigilance-safety-alerts",
    "business-tax/large-midsize-business-guidance",
    "business-tax/life-insurance-policies",
    "oil-and-gas/finance-and-taxation",
    "law-justice-system/attorney-general-guidance-to-legal-profession",
    "crime-policing/policing-crime-prevention",
    "public-safety-emergencies/emergencies-preparation-response-recovery",
    "help-british-nationals-overseas/asia",
    "help-british-nationals-overseas/africa",
    "help-british-nationals-overseas/europe",
    "help-british-nationals-overseas/advice-all-countries",
    "help-british-nationals-overseas/antarctica-australia-oceania",
    "help-british-nationals-overseas/middle-east",
    "help-british-nationals-overseas/north-central-america-caribbean",
    "help-british-nationals-overseas/south-america",
    "company-registration-filing/forms",
    "housing/freehold-leasehold-property",
    "housing/party-walls",
    "housing/tenancies-leases",
    "planning-development/building-regulations",
    "planning-development/planning-officer-guidance",
    "planning-development/public-sector-land-use",
    "keeping-farmed-animals/pig-identity-registration-movements",
    "keeping-farmed-animals/import-export",
    "local-government/pensions",
    "farming-food-grants-payments/rural-grants-payments",
    "driving-tests-and-learning-to-drive/book-tests",
    "driving-tests-and-learning-to-drive/car",
    "driving-tests-and-learning-to-drive/lorry-bus",
    "driving-tests-and-learning-to-drive/specialist",
    "driving-tests-and-learning-to-drive/motorcycle",
    "mot/lorry-bus-trailer-annual-test",
    "driving-tests-and-learning-to-drive/cars-trailers",
    "health-protection/immunisation",
    "health-protection/migrant-health-guide",
    "high-speed-2/about-route",
    "keeping-farmed-animals/animal-feed",
    "keeping-farmed-animals/dealing-with-dead-animals",
    "keeping-farmed-animals/deer-farming",
    "keeping-farmed-animals/veterinary-medicines",
    "population-screening-programmes/abdominal-aortic-aneurysm",
    "population-screening-programmes/bowel",
    "population-screening-programmes/breast",
    "population-screening-programmes/cervical",
    "population-screening-programmes/diabetic-eye",
    "population-screening-programmes/fetal-anomaly",
    "population-screening-programmes/infectious-diseases-in-pregnancy",
    "population-screening-programmes/newborn-blood-spot",
    "population-screening-programmes/newborn-hearing",
    "population-screening-programmes/newborn-infant-physical-examination",
    "population-screening-programmes/sickle-cell-thalassaemia",
    "immigration-operational-guidance/visitors",
    "medicines-medical-devices-blood/conferences-and-events",
    "medicines-medical-devices-blood/payment-and-fees",
    "business-enterprise/importing-exporting",
    "work-careers/public-service-pensions",
    "work-careers/trade-unions",
    "work-careers/secondments-with-government",
    "work-careers/government-graduate-schemes",
    "government/government-funding-programmes",
    "business-enterprise/business-auditing-accounting-reporting",
    "business-enterprise/european-regional-development-funding",
    "business-enterprise/licensing",
    "government/government-owned-property-land",
    "government/national-and-official-statistics",
    "business-enterprise/scientific-research-and-development",
    "law-justice-system/domestic-violence",
    "higher-education/administration",
    "higher-education/scholarships-for-overseas-students",
    "law-justice-system/statutory-rights",
    "climate-change-energy/climate-change-agreements",
    "climate-change-energy/energy-efficiency",
    "climate-change-energy/energy-infrastructure",
    "climate-change-energy/energy-prices-bills",
    "climate-change-energy/energy-security",
    "climate-change-energy/international-climate-change",
    "benefits-credits/universal-credit",
    "death/death-registration-disclosure",
    "climate-change-energy/emissions",
    "climate-change-energy/low-carbon-energy",
    "government/european-union-laws-and-regulation",
    "government/public-services",
    "government/devolution",
    "government/legislative-process",
    "business-enterprise/farming",
    "environmental-management/air-quality",
    "business-tax/stamp-duty-on-shares",
    "law-justice-system/forced-marriage",
    "producing-distributing-food/plant-health-seeds",
    "environmental-management/assessing-environmental-impact",
    "crime-policing/criminal-record-disclosure",
    "local-communities/arts-culture-sport",
    "farming-food-grants-payments/state-aid",
    "animal-welfare/pets",
    "business-enterprise/export-finance",
    "planning-development/planning-permission-appeals",
    "planning-development/environmental-planning",
    "further-education-skills/learning-records-service",
    "local-government/local-housing-allowance",
    "planning-development/local-plans",
    "coal/water-management",
    "mot/provide-mot-training",
    "local-government/byelaws",
    "ships-cargoes/requirements-for-reporting-vessels",
    "government-digital-guidance/technology-guidance",
    "government-digital-guidance/technology-guidance-accessibility",
    "technology-guidance/technology-guidance-accessibility",
    "technology-guidance/technology-guidance-apis",
    "technology-guidance/technology-guidance-application-development",
    "technology-guidance/technology-guidance-email",
    "technology-guidance/technology-guidance-buying-technology",
    "technology-guidance/technology-guidance-cloud-security",
    "technology-guidance/technology-guidance-cloud-strategy",
    "technology-guidance/technology-guidance-cyber-security",
    "technology-guidance/technology-guidance-data-protection",
    "technology-guidance/technology-guidance-data-provisioning-usage",
    "technology-guidance/technology-guidance-design-principles",
    "technology-guidance/technology-guidance-digital-inclusion",
    "technology-guidance/technology-guidance-digital-marketplace",
    "technology-guidance/technology-guidance-digital-outcomes-and-specialists-framework",
    "technology-guidance/technology-guidance-digital-service-security",
    "technology-guidance/technology-guidance-digital-service-standard",
    "technology-guidance/technology-guidance-digital-transformation",
    "technology-guidance/technology-guidance-end-user-devices",
    "technology-guidance/technology-guidance-govuk-notify",
    "technology-guidance/technology-guidance-govuk-pay",
    "technology-guidance/technology-guidance-govuk-proposition",
    "technology-guidance/technology-guidance-govuk-registers",
    "technology-guidance/technology-guidance-govuk-verify",
    "technology-guidance/technology-guidance-govuk-platform-as-a-service",
    "technology-guidance/technology-guidance-govwifi",
    "technology-guidance/technology-guidance-green-technology",
    "technology-guidance/technology-guidance-hosting-your-service",
    "technology-guidance/technology-guidance-identity-assurance",
    "technology-guidance/technology-guidance-job-roles",
    "technology-guidance/technology-guidance-legacy",
    "technology-guidance/technology-guidance-managing-government-websites",
    "technology-guidance/technology-guidance-networking",
    "technology-guidance/technology-guidance-open-source",
    "technology-guidance/technology-guidance-open-standards",
    "technology-guidance/technology-guidance-passwords",
    "technology-guidance/technology-guidance-performance-platform",
    "technology-guidance/technology-guidance-phishing",
    "technology-guidance/technology-guidance-psn",
    "technology-guidance/technology-guidance-registers",
    "technology-guidance/technology-guidance-risk-management",
    "technology-guidance/technology-guidance-smarter-working",
    "technology-guidance/technology-guidance-talent-acquisition",
    "technology-guidance/technology-guidance-telecommunications",
    "technology-guidance/technology-guidance-user-research",
    "mot/lorry-bus-trailer-specialist-tests",
    "immigration-operational-guidance/nationality-guidance",
    "business-tax/soft-drinks-industry-levy",
    "population-screening-programmes/population-screening-evidence-guidance",
    "population-screening-programmes/population-screening-data-key-performance-indicators",
    "population-screening-programmes/population-screening-quality-assurance",
    "immigration-operational-guidance/windrush-scheme",
    "environmental-management/forestry",
    "intellectual-property/crime-and-infringement",
    "business-tax/digital-services-tax",
  ]
end
